#########Команды postgresql для создания Базы данных голосования#####################

CREATE SCHEMA domodel;

SET SEARCH_PATH TO domodel;

### МОДУЛЬ АВТОРИЗАЦИИ ###
CREATE TABLE users (id bigserial not null, username varchar(50) not null UNIQUE, password varchar(255) not null, enabled boolean not null, creation_date timestamp not null, first_name varchar(255), second_name varchar(255), middle_name varchar(255), email varchar(255) UNIQUE, photo_link varchar(255), address varchar(255), PRIMARY KEY (id));
CREATE TABLE authorities (id serial not null, authority varchar(100) not null, PRIMARY KEY (id));
CREATE TABLE users_authorities (user_id bigint not null, authority_id int not null, FOREIGN KEY (user_id) REFERENCES users (id), FOREIGN KEY (authority_id) REFERENCES authorities (id));
INSERT INTO users (username, password, enabled, creation_date, first_name, second_name, middle_name, email, photo_link, address) VALUES ('admin', '$2a$10$ArsakpPHT5jPbPEAeVc/lup1V4tJS9hqaa1PfRNIUy459JkPjK5xS', true, '2020-08-08', 'Иван', 'Иванов', 'Иванович', 'ivan@mail.ru', 'myfoto.png', 'Где эта улица, где этот дом');
INSERT INTO authorities (authority) VALUES ('ROLE_ADMIN'), ('ROLE_DIRECTOR'), ('ROLE_USER');
INSERT INTO users_authorities (user_id, authority_id) VALUES (1, 1);

### МОДУЛЬ НОВОСТЕЙ ###
INSERT INTO news (creation_date, title, full_text, picture_link, author_id, hidden, pinned, visible) VALUES ('2020-08-06', 'Заголовок первой новости', 'Полный текст первой новости, загруженной из сервиса новостей', '1.png', 1, false, false, true);
INSERT INTO news (creation_date, title, full_text, picture_link, author_id, hidden, pinned, visible) VALUES ('2020-08-20', 'Заголовок второй новости', 'Полный текст второй новости, загруженной из сервиса новостей. Новость закреплена и должны отображаться первой!', '1.png', 1, false, true, true);

### ВВЕДЕНИЕ ДАННЫХ В МОДУЛИ ПЛАТЕЖНЫХ СЧЕТОВ И СЧЕТЧИКОВ ПОКАЗАНИЙ ###
INSERT INTO accounts (user_id, street, house_number, acres_amount) VALUES (1, 'Первая улица', '1й дом', 7);
INSERT INTO accounts (user_id, street, house_number, acres_amount) VALUES (1, 'Вторая улица', '2й дом', 10);
INSERT INTO tariffs (description, price) VALUES ('Тариф на воду', 100);
INSERT INTO tariffs (description, price) VALUES ('Единый тариф на электричество', 50);
INSERT INTO tariffs (description, price) VALUES ('Дневной тариф на электричество', 60);
INSERT INTO tariffs (description, price) VALUES ('Ночной тариф на электричество', 40);
INSERT INTO meters (account_id, serial_number, model, check_date, type, tariff_id) VALUES (1, '9988776655', 'Модель 1', '2021-05-10', 0, 1);
INSERT INTO meters (account_id, serial_number, model, check_date, type, tariff_id) VALUES (1, '9876543210', 'Модель 2', '2021-06-30', 1, 2);
INSERT INTO meters (account_id, serial_number, model, check_date, type, tariff_id) VALUES (2, '0123456789', 'Модель 3', '2022-07-20', 2, 3);
INSERT INTO meters (account_id, serial_number, model, check_date, type, tariff_id) VALUES (2, '1122335566', 'Модель 4', '2022-08-25', 3, 4);
INSERT INTO meter_datas (meter_id, creation_date, value)VALUES (1, '2020-07-20', 55);
INSERT INTO meter_datas (meter_id, creation_date, value)VALUES (1, '2020-08-20', 70);
INSERT INTO meter_datas (meter_id, creation_date, value)VALUES (2, '2020-07-15', 30);
INSERT INTO meter_datas (meter_id, creation_date, value)VALUES (2, '2020-08-25', 40);
INSERT INTO meter_datas (meter_id, creation_date, value)VALUES (3, '2020-07-19', 66);
INSERT INTO meter_datas (meter_id, creation_date, value)VALUES (3, '2020-08-23', 88);
INSERT INTO meter_datas (meter_id, creation_date, value)VALUES (4, '2020-07-30', 51);
INSERT INTO meter_datas (meter_id, creation_date, value)VALUES (4, '2020-08-31', 95);
INSERT INTO requisites (company_name, company_address, inn, kpp, ogrn, bank_account, bank_name, bik, correspondent_account, email, phone_number) VALUES ('ООО “ДОМОДЕЛ”', 'Московская область, домодедовский район', 11111111, 22222222, 33333333, '324493100000000024578', 'Банк Москвы', 44444444, '89993100000000024578', 'domodel@mail.ru', '89123456789');
INSERT INTO bills (account_id, creation_date, target, total, payment_status, requisites_id) VALUES (1, '2020-08-20', 'назначение платежа: счетчики', 333, true, 1);
INSERT INTO bills (account_id, creation_date, target, total, payment_status, requisites_id) VALUES (1, '2020-08-20', 'назначение платежа: взнос', 555, false, 1);
INSERT INTO calculations (bill_id, previous_data, current_data, amount, price, cost) VALUES (1, 1, 2, 77, 9, 693);

### МОДУЛЬ ИНФОРМАЦИИ О КОМПАНИИ ###


### РАБОТА С БД ###

SELECT * FROM products;
SELECT * FROM users;
SELECT * FROM authorities;

DROP TABLE accounts CASCADE;
DROP TABLE bills CASCADE;
DROP TABLE calculations CASCADE;
DROP TABLE meters CASCADE;
DROP TABLE meter_datas;
DROP TABLE requisites CASCADE;
DROP TABLE tariffs;
DROP TABLE news;
DROP TABLE users_authorities CASCADE;
DROP TABLE authorities CASCADE;
DROP TABLE users CASCADE;

alter table users drop column login;
alter table users add column username varchar(50) not null UNIQUE;
update users set photo_link = 'myfoto.png' where username = 'admin';
CREATE TABLE news (id bigserial not null, creation_date date not null, title varchar(255) not null, full_text varchar(2000) not null, picture_link varchar(255), hidden boolean not null, pinned boolean not null, author_id bigint not null, FOREIGN KEY (author_id) REFERENCES users (id), PRIMARY KEY (id));

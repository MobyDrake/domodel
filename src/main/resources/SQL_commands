#########Команды postgresql для создания Базы данных голосования#####################

CREATE SCHEMA domodel;

SET SEARCH_PATH TO domodel;

### МОДУЛЬ АВТОРИЗАЦИИ ###
CREATE TABLE users (id bigserial not null, username varchar(50) not null UNIQUE, password varchar(255) not null, enabled boolean not null, creation_date timestamp not null, first_name varchar(255), second_name varchar(255), middle_name varchar(255), email varchar(255) UNIQUE, photo_link varchar(255), PRIMARY KEY (id));
CREATE TABLE authorities (id serial not null, authority varchar(100) not null, PRIMARY KEY (id));
CREATE TABLE users_authorities (user_id bigint not null, authority_id int not null, FOREIGN KEY (user_id) REFERENCES users (id), FOREIGN KEY (authority_id) REFERENCES authorities (id));
INSERT INTO users (username, password, enabled, creation_date, first_name, second_name, middle_name, email, photo_link) VALUES ('admin', '$2a$10$ArsakpPHT5jPbPEAeVc/lup1V4tJS9hqaa1PfRNIUy459JkPjK5xS', true, '2020-08-08', 'Ivan', 'Ivanov', 'Ivanovich', 'ivan@mail.ru', 'myfoto.png');
INSERT INTO authorities (authority) VALUES ('ROLE_ADMIN'), ('ROLE_DIRECTOR'), ('ROLE_USER');
INSERT INTO users_authorities (user_id, authority_id) VALUES (1, 1);

### МОДУЛЬ НОВОСТЕЙ ###
INSERT INTO news (creation_date, title, full_text, picture_link, hidden, pinned, visible, author_id) VALUES ('2020-08-06', 'Заголовок новости', 'Полный текст последней по дате новости, загруженной из сервиса новостей', '1.png', false, true, true, 1);

### ВВЕДЕНИЕ ДАННЫХ В МОДУЛИ ПЛАТЕЖНЫХ СЧЕТОВ И СЧЕТЧИКОВ ПОКАЗАНИЙ ###
INSERT INTO accounts (user_id, street, house_number, acres_amount) VALUES (1, 'первая улица', '1й дом', 7);
INSERT INTO accounts (user_id, street, house_number, acres_amount) VALUES (1, 'первая улица', '2й дом', 10);
INSERT INTO tariffs (description, price, default_increase_value) VALUES ('тариф на воду', 100, 10);
INSERT INTO tariffs (description, price, default_increase_value) VALUES ('тариф на электричество', 50, 5);
INSERT INTO meters (account_id, serial_number, check_date, type, tariff_id) VALUES (1, 123456, '2020-05-10', 1, 1);
INSERT INTO meters (account_id, serial_number, check_date, type, tariff_id) VALUES (1, 987654, '2020-06-30', 2, 2);
INSERT INTO meters (account_id, serial_number, check_date, type, tariff_id) VALUES (2, 456789, '2020-07-20', 1, 1);
INSERT INTO meter_datas (meter_id, creation_date, value, autogenerated)VALUES (1, '2020-07-20', 55, false);
INSERT INTO meter_datas (meter_id, creation_date, value, autogenerated)VALUES (1, '2020-08-20', 70, false);
INSERT INTO meter_datas (meter_id, creation_date, value, autogenerated)VALUES (2, '2020-07-15', 30, false);
INSERT INTO meter_datas (meter_id, creation_date, value, autogenerated)VALUES (2, '2020-08-25', 40, false);
INSERT INTO meter_datas (meter_id, creation_date, value, autogenerated)VALUES (3, '2020-07-19', 66, false);
INSERT INTO meter_datas (meter_id, creation_date, value, autogenerated)VALUES (3, '2020-08-23', 88, false);
INSERT INTO requisites (company_name, company_address, inn, kpp, ogrn, bank_account, bank_name, bik, correspondent_account, email, phone_number) VALUES ('ООО “ДОМОДЕЛ”', 'Московская область, домодедовский район', 11111111, 22222222, 33333333, '324493100000000024578', 'Банк Москвы', 44444444, '89993100000000024578', 'domodel@mail.ru', '89123456789');
INSERT INTO bills (account_id, creation_date, target, total, calculated, send_status, payment_status, requisites_id) VALUES (1, '2020-08-20', 'назначение платежа: счетчики', 333, true, 1, false, 1);
INSERT INTO bills (account_id, creation_date, target, total, calculated, send_status, payment_status, requisites_id) VALUES (1, '2020-08-20', 'назначение платежа: взнос', 555, false, 1, false, 1);
INSERT INTO calculations (bill_id, previous_data, current_data, amount, price, cost, calculated) VALUES (1, 1, 2, 77, 9, 693, true);

### МОДУЛЬ ИНФОРМАЦИИ О КОМПАНИИ ###


### РАБОТА С БД ###

SELECT * FROM products;
SELECT * FROM users;
SELECT * FROM authorities;

DROP TABLE accounts CASCADE;
DROP TABLE bills CASCADE;
DROP TABLE calculations CASCADE;
DROP TABLE meters CASCADE;
DROP TABLE meter_datas;
DROP TABLE requisites CASCADE;
DROP TABLE tariffs;
DROP TABLE news;
DROP TABLE users_authorities CASCADE;
DROP TABLE authorities CASCADE;
DROP TABLE users CASCADE;

alter table users drop column login;
alter table users add column username varchar(50) not null UNIQUE;
update users set photo_link = 'myfoto.png' where username = 'admin';
CREATE TABLE news (id bigserial not null, creation_date date not null, title varchar(255) not null, full_text varchar(2000) not null, picture_link varchar(255), hidden boolean not null, pinned boolean not null, author_id bigint not null, FOREIGN KEY (author_id) REFERENCES users (id), PRIMARY KEY (id));

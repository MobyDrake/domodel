#########Команды postgresql для создания Базы данных голосования#####################

CREATE SCHEMA domodel;

SET SEARCH_PATH TO domodel;

### МОДУЛЬ АВТОРИЗАЦИИ ###
CREATE TABLE users (id bigserial not null, username varchar(50) not null UNIQUE, password varchar(255) not null, enabled boolean not null, creation_date timestamp not null, first_name varchar(255), second_name varchar(255), middle_name varchar(255), email varchar(255) UNIQUE, photo_link varchar(255), PRIMARY KEY (id));
CREATE TABLE authorities (id serial not null, authority varchar(100) not null, PRIMARY KEY (id));
CREATE TABLE users_authorities (user_id bigint not null, authority_id int not null, FOREIGN KEY (user_id) REFERENCES users (id), FOREIGN KEY (authority_id) REFERENCES authorities (id));
INSERT INTO users (username, password, enabled, creation_date, first_name, second_name, middle_name, email, photo_link) VALUES ('admin', '$2a$10$ArsakpPHT5jPbPEAeVc/lup1V4tJS9hqaa1PfRNIUy459JkPjK5xS', true, '2020-08-08', 'Ivan', 'Ivanov', 'Ivanovich', 'ivan@mail.ru', 'myfoto.png');
INSERT INTO authorities (authority) VALUES ('ROLE_ADMIN'), ('ROLE_DIRECTOR'), ('ROLE_USER');
INSERT INTO users_authorities (user_id, authority_id) VALUES (1, 1);

### МОДУЛЬ НОВОСТЕЙ ###
CREATE TABLE news (id bigserial not null, creation_date date not null, title varchar(255) not null, full_text varchar(2000) not null, picture_link varchar(255), hidden boolean not null, pinned boolean not null, author_id bigint not null, FOREIGN KEY (author_id) REFERENCES users (id), PRIMARY KEY (id));
INSERT INTO news (creation_date, title, full_text, picture_link, hidden, pinned, author_id) VALUES ('2020-08-06', 'Заголовок новости', 'Полный текст последней по дате новости, загруженной из сервиса новостей', '1.png', false, true, 1);

### МОДУЛЬ НАЧИСЛЕНИЙ ###
#TODO create table accounts
#TODO create table meters
#TODO create table meter_datas

### МОДУЛЬ ПЛАТЕЖНЫХ ПОРУЧЕНИЙ ###
#TODO create table bills
#TODO create table calculations
#TODO create table tariffs

### МОДУЛЬ ИНФОРМАЦИИ О КОМПАНИИ ###
#TODO create table requisites


### РАБОТА С БД ###

SELECT * FROM products;
SELECT * FROM users;
SELECT * FROM authorities;

DROP TABLE accounts CASCADE;
DROP TABLE bills CASCADE;
DROP TABLE calculations CASCADE;
DROP TABLE meters CASCADE;
DROP TABLE meter_datas;
DROP TABLE requisites;
DROP TABLE tariffs;
DROP TABLE news;
DROP TABLE users_authorities CASCADE;
DROP TABLE authorities CASCADE;
DROP TABLE users CASCADE;

alter table users drop column login;
alter table users add column username varchar(50) not null UNIQUE;
update users set photo_link = 'myfoto.png' where username = 'admin';